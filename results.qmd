# Results

*Instructions:* *You have a lot of freedom to choose what to do, as long as you restrict yourselves to exploratory techniques (rather than modeling / prediction approaches). In addition, your analysis must be clearly documented and reproducible.*

*Provide a short nontechnical summary of the most revealing findings of your analysis written for a nontechnical audience. Take extra care to clean up your graphs, ensuring that best practices for presentation are followed, as described in the audience ready style section below.*

*Use subheadings (##) as appropriate. See Todd Schneider's blog posts for examples of thoughtful, informative subheadings. An approach that works well is to create a subheading for each of your research questions.*

*The number of graphs will vary by project; we suggest a target of 10. (A plot with multiple facets counts as 1 graph). If you go over, make sure they are high quality and include commentary. A project with 10 good graphs plus commentary will receive a better grade than a project with 10 good graphs and 10 mediocre ones.*

```{r message=FALSE}
library(dplyr)
library(readr)
library(dplyr)
library(forcats)
library(ggplot2)
library(scales)
library(tidyr)
library(maps)
```

## Preliminary Analysis - Aggregate Numbers

### Main Causes

First, we will get the dataset ready for analysis.

```{r message=FALSE}
#We begin by loading the dataframe and renaming some columns for easier handling
cdc_dataset = read_csv("NCHS_Leading_Causes_of_Death_United_States_2020.csv")
cdc_dataset <- cdc_dataset %>% rename(Cause = `Cause Name`)
cdc_dataset <- cdc_dataset %>% rename(Age_Adj_Rate = `Age Adjusted Rate`)
cdc_dataset <- cdc_dataset %>% rename(Crude_Rate = `Crude Rate`)

#Replacing NA with zero in all columns as mentioned in the previous section
cdc_dataset <- cdc_dataset |> mutate_all(~ifelse(is.na(.), 0, .))

#We will not use '113 Cause Name' but 'Cause Name'
cdc_dataset <- cdc_dataset |> select(-`113 Cause Name`)
```

We will select the 10 most important causes of death from a historical perspective in the United States.

```{r message=FALSE}
cdc_usa <- cdc_dataset[cdc_dataset$State == "United States", ]

#Detecting the top 10 most important causes of death in the US from 1999 to 2020
cdc_usa_summary <- cdc_usa |> group_by(Cause) |> summarize(Total_Deaths = sum(Deaths)) |> 
  arrange(desc(Total_Deaths)) |> top_n(10, Total_Deaths)

# Creating the bar chart for top 10 causes
ggplot(cdc_usa_summary, aes(x = reorder(Cause, Total_Deaths), y = Total_Deaths)) +
  geom_bar(stat = "identity", fill = '#8B4513') +
  coord_flip() + labs(title = "Most Relevant Causes of Death - 1999 to 2020", y = "Total Number of Deaths (Millions)", x = "Cause Name") + 
  scale_y_continuous(labels = scales::comma_format(scale = 1e-6), breaks = scales::pretty_breaks(n = 10)) +
  theme_minimal()
```

The bar chart above identifies 10 most common causes of death in the United States aggregated from year 1999 to 2020. It's is visible that heart disease and cancer account for a significant bulk of all deaths. We will focus our analysis on these.

```{r}
#Filtering cdc_dataset by the top 10 Cause Name from cdc_usa_summary
cdc_dataset <- cdc_dataset[cdc_dataset$Cause %in%  cdc_usa_summary$Cause, ]
cdc_usa  <- cdc_usa[cdc_usa$Cause %in%  cdc_usa_summary$Cause, ]
# rm(cdc_usa_summary)
```

Notice that the deaths incorporated in these 10 categories, are almost 90% of the total figure of deaths.

### Understanding overall trends

As population grows, deaths (with a lag) will eventually grow. We would like to understand the interplay between population growth, deaths growth, and the evolution of death rates since 1999. For this, we will create metrics and facet them in time series.

```{r}
#Grouping by Year and State, and summarizing the data. We can take min(Population) to keep the population of that year
cdc_usa_grouped <- cdc_usa |> group_by(Year) |>
  summarize(
    Deaths = sum(Deaths),
    Population = min(Population),
    Crude_Rate = sum(Crude_Rate),
    Age_Adj_Rate = sum(Age_Adj_Rate),
    .groups = 'drop'
  )


#Reshaping data using pivot_longer so we can facet by metric:
cdc_usa_long <- cdc_usa_grouped |> 
  pivot_longer(cols = c(Deaths, Population, Crude_Rate, Age_Adj_Rate), names_to = "Metric", values_to = "Value")

#Adjusting the order and names of the metrics
cdc_usa_long$Metric <- factor(cdc_usa_long$Metric, 
                                      levels = c("Population", "Crude_Rate", "Deaths", "Age_Adj_Rate"),
                                      labels = c("Population in US", "Crude Death Rate", "Deaths", "Age Adjusted Death Rate"))

#Creating the time series:
ggplot(cdc_usa_long, aes(x = Year, y = Value)) +
  geom_line(color = "#FF6C22", size = 1.2) +
  facet_wrap(~ Metric, scales = "free_y", ncol = 2) +
  labs(title = "Time Series", x = "Year", y = "Value") +
  scale_y_continuous(labels = scales::comma, breaks = scales::pretty_breaks(n = 4)) +
  theme_bw()
```

Let's make some general observations:

-   Population went from 280 millions in 1999 to 330 in 2020. This is an approximate growth of 18%.
-   In the same period, death increased by 16%, which is less than population growth.
-   The Crude Death Rate, which is simply the number of deaths divided by the total population times 100,000 reflects this fact going down to 665 from 680. This means that the death rate went down 2.2%.
-   However, and more surprising, age adjusted death rate reduced 29%.

A good way to compare the trends, would be to observe the cumulative perceptual growth of each metric, in a single time series plot:

```{r}
#Calculating cumulative percentual change for each column
cdc_usa_grouped_cum <- cdc_usa_grouped |>
  mutate(
    Deaths = Deaths / first(Deaths) - 1,
    Population = Population / first(Population) - 1,
    Crude_Rate = Crude_Rate / first(Crude_Rate) - 1,
    Age_Adj_Rate = Age_Adj_Rate / first(Age_Adj_Rate) - 1
  )

#pivot_longer this data:
cdc_usa_grouped_cum <- cdc_usa_grouped_cum |>
  pivot_longer(cols = -Year, names_to = "Metric", values_to = "Cumulative Change")


#Creating the time series plot
ggplot(cdc_usa_grouped_cum, aes(x = Year, y = `Cumulative Change`, color = Metric)) +
  geom_line(size = 1.3) +
  labs(title = "Cumulative Percentual Change (1999-2020)", x = "Year", 
       y = "Cumulative Percentual Change", color = "Metric") +
  theme_minimal() +
  theme(legend.position = "bottom") +
  scale_y_continuous(labels = scales::percent_format(), breaks = scales::pretty_breaks(n = 8))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10))

```

General observations:

-   As stated before, population growth has been steady in the period.
-   Between 1999 and 2012, Total Deaths were approximately constant while the population grew steadily. This provoked the Crude Rate to decrease sharply (denominator increasing). However, from 2013 to 2020, we observed a sharp increase in Deaths, growing around 10% in 7 years. Interestingly, 6% was given from 2013 to 2019 and 4% in 2020. The issue is that COVID-19 exacerbated the severity of other diseases, causing more deaths, which were categorized not as COVID-19 directly. Remember that in this dataset, we omit COVID-19, but we, in fact, see an effect from the pandemic, which is seen in the spikes of 2020.
-   Although population growth lost some steam from 2013 to 2020, the real cause of the increase in the crude rate of deaths is a sharp increase in deaths.
-   While the crude rate increased considerably during the period, the age-adjusted death rate kept decreasing. This metric takes into consideration the age distribution of people. If deaths increase because people are aging, it assigns a lesser weight to the metric by weighting by age buckets. This means the metric can be compared across populations with different age structures. Overall, we can say that the increase in deaths has been primarily due to an aging population.
-   We can observe how the population has aged by observing the Population Pyramids for the United States in the image below. The U.S. Census Bureau created the Pyramid Population charts that show how the US has aged in the last two decades.
-   We say in aggregate because we will break down by cause and see if we can confirm this intuition.
-   Finally, the relatively milder uptick in the Age-Adjusted-Death-Rate in 2020 versus the Crude Rate can be interpreted as COVID causing more deaths in elderly people. The last went up 3.5% that year, while the former was 4.5%.

![](https://www.census.gov/content/dam/Census/library/stories/2023/05/aging-united-states-population-fewer-children-in-2020-figure-2.jpg){width="110%"}

### Understanding the underlying causes of death

According to the CDC, the best metric to study death evolution is using age-adjusted death rates. We then begin by investigating the evolution of age adjusted death rate across time.

```{r}
#Creating a faceting chart, which will have age adjusted death rates by cause of death:
df_usa_cause <- cdc_usa |> select(Year, Cause, Age_Adj_Rate)
ggplot(df_usa_cause, aes(x = Year, y = Age_Adj_Rate, group = Cause, color = Cause)) +
  geom_line(size = 0.5) + # Thicker lines
  facet_wrap(~ Cause, scales = "free_y") +
  theme_bw() +
  labs(title = "Time Series of Causes of Death in the USA", x = "Year", y = "Age Adjusted Death Rate")+ 
  guides(color = "none") +
  geom_point()
```

We can make the following observations:

-   As seen before, the overall age adjusted death rate in the United States is in aggregate decreasing since 1999
-   However, not all causes share the same decreasing shape. For instance, Alzheimer's, Unintentional injuries and suicide, have been increasing dramatically.
-   Overall, Cancer, CLRD (Chronic lower respiratory diseases), Heart diseases, Kidney diseases and Strokes have shown an impressive reduction in deaths.
-   Diabetes seems to be a cause for concern, but it can be explained by COVID-19: "Several underlying medical conditions can increase the risk of severe illness and a higher likelihood of lethality if a person contracts COVID-19, including diabetes".

The different types of causes don't share the same dimensions. We can compare the evolution of these death-rates calculating the percentual growth over time:

```{r}
cdc_usa_wider <- df_usa_cause |> 
  pivot_wider(
    id_cols = Year,
    names_from = Cause,
    values_from = Age_Adj_Rate
  )

#Calculating cumulative percentual change for each column
cdc_usa_wider <- cdc_usa_wider |> mutate(across(-Year, ~ ./first(.) - 1))


#pivot_longer this data:
cdc_usa_wider <- cdc_usa_wider |> pivot_longer(cols = -Year, names_to = "Metric", values_to = "Cumulative Change")

#We use a color blind friendly palette
color_blind_friendly <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", 
                          "#0072B2", "#D55E00", "#CC79A7", "#999999", 
                          "#882255", "#88CCEE")

#Creating the time series plot
ggplot(cdc_usa_wider, aes(x = Year, y = `Cumulative Change`, color = Metric)) +
  geom_line(size = 1) +
  labs(title = "Cumulative Change - Age Adj. Death Rate", x = "Year", y = "Cumulative Percentual Change", color = "Metric") +
  theme_minimal() +
  theme(legend.position = "right") +
  scale_y_continuous(labels = scales::percent_format(), breaks = scales::pretty_breaks(n = 8))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_color_manual(values = color_blind_friendly) 

```

With the cumulative percentage time series graph broken down by cause, we can see some interesting trends and better understand the trends over time. In particular, deaths caused by Alzheimer's disease is aggressively increasing year by year. Unintentional injuries and suicide are the number two and number three fastest growing causes of death, respectively. Additionally, we can note that stroke, influenza and pneumonia, and heart disease have actually been decreasing during the same time of 1999-2020. Those we should note that death from Stroke, Influenza and pneumonia, and heart disease diseases showed a decreasing trend until 2012, but then began to grow again.

The overall trend is downward for the age adjusted death rate. However, we have identified three causes that show a different behavior. Now we will try to identify which states are leading in these metrics.




### Disaggregating by state


```{r, fig.height=7, fig.width= 5.5}
#Filter the data for the specified conditions
df_rank1 <- cdc_dataset |> filter(State != 'United States') |>
  select(Year, State, Cause, Age_Adj_Rate)|> 
  filter(Year %in% c(1999, 2020), Cause == "Alzheimer's disease")

# Calculating the percentual difference change from 2000 to 2017 for each state
df_rank1 <- df_rank1 %>%
  pivot_wider(names_from = Year, values_from = Age_Adj_Rate) |>
  mutate(PercentChange = `2020`/`1999`-1) |>
  arrange(desc(PercentChange))


#Cleveland
ggplot(df_rank1, aes(x = PercentChange, y = reorder(State, PercentChange))) +
  geom_point(size = 3, color = "darkgreen") +
  labs(title = "Alzheimer's Disease %Chg. in Age Adj. Death Rate", x = "Percentage Change 1999 to 2020", y = 'State') +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(colour = "grey60", linetype = "dashed"))+
  scale_x_continuous(labels = scales::percent_format(), breaks = scales::pretty_breaks(n = 8))+
  theme(legend.position = "none")
```

We can see that Mississippi, Arkansas and Alabama have seen the largest increase, while Maine, Maryland and Montana are the smallest.


```{r, fig.height=7, fig.width= 5.5}
#Filter the data for the specified conditions
df_rank2 <- cdc_dataset |> filter(State != 'United States') |>
  select(Year, State, Cause, Age_Adj_Rate)|> 
  filter(Year %in% c(1999, 2020), Cause == "Unintentional injuries")

# Calculating the percentual difference change from 2000 to 2017 for each state
df_rank2 <- df_rank2 %>%
  pivot_wider(names_from = Year, values_from = Age_Adj_Rate) |>
  mutate(PercentChange = `2020`/`1999`-1) |>
  arrange(desc(PercentChange))


#Cleveland
ggplot(df_rank2, aes(x = PercentChange, y = reorder(State, PercentChange))) +
  geom_point(size = 3, color = "darkblue") +
  labs(title = "Unintent. Injuries %Chg in Age Adj Death Rate", x = "Percentage Change 1999 to 2020", y = 'State') +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(colour = "grey60", linetype = "dashed"))+
  scale_x_continuous(labels = scales::percent_format(), breaks = scales::pretty_breaks(n = 8))+
  theme(legend.position = "none")
```

We can see that Rhode Island, West Virginia, and Massachusetts have seen the largest increase, while Idaho, Nebraska and Alabama are the smallest.

```{r, fig.height=7, fig.width= 5.5}
#Filter the data for the specified conditions
df_rank3 <- cdc_dataset |> filter(State != 'United States') |>
  select(Year, State, Cause, Age_Adj_Rate)|> 
  filter(Year %in% c(1999, 2020), Cause == "Suicide")

# Calculating the percentual difference change from 2000 to 2017 for each state
df_rank3 <- df_rank3 %>%
  pivot_wider(names_from = Year, values_from = Age_Adj_Rate) |>
  mutate(PercentChange = `2020`/`1999`-1) |>
  arrange(desc(PercentChange))


#Cleveland
ggplot(df_rank3, aes(x = PercentChange, y = reorder(State, PercentChange))) +
  geom_point(size = 3, color = "orange") +
  labs(title = "Suicide %Chg. in Age Adj. Death Rate", x = "Percentage Change 1999 to 2020", y = 'State') +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(colour = "grey60", linetype = "dashed"))+
  scale_x_continuous(labels = scales::percent_format(), breaks = scales::pretty_breaks(n = 8))+
  theme(legend.position = "none")
```

We can see that Vermont, Iowa and Kansas have seen the largest increase, while California, Rhode Island and Nevada are the smallest.



It is interesting to note that in the case of Alzheimer's, Unintentional Injuries and Suicide, the three diseases exhibit increasing age adjusted rates in the period. There are only a few exceptions such as Nevada and Rhode Island in Suicide or Maine in Alzheimer's where a decreasing rate has been seen. For this reason, we believe it is worth looking at box plots to identify outliers and find explanations for them.

```{r}
df_box <- rbind(
  df_rank1[, c("State", "Cause", "PercentChange")],
  df_rank2[, c("State", "Cause", "PercentChange")],
  df_rank3[, c("State", "Cause", "PercentChange")]
)

ggplot(df_box, aes(x = Cause, y = PercentChange)) +
  geom_boxplot(fill = "#A6CF98", color = "black") + 
  theme_bw() + labs(title = "Box-Plot: Percent Change by Cause - 1999 to 2020 - by States", x = "Cause", y = "Percent Change") +
  scale_y_continuous(labels = scales::percent)

```
Matching these values with the previous cleveland dot plots, we can say that Mississippi is an outlier for Alzheimer. Rhode Island and West Virginia are outliers for Unintentional Injuries. Finally, Suicide seems to not have any outlier. From the boxplots we also notice that the three causes are skewed to the right. 




### Analyzing Alzheimer's Disease

Apparently the states most affected by Alzheimer's are in the southern part of the United States. Given the possible geographical dependence, we propose to corroborate the information with the following geospatial visualization.

To make the differences more notorious, we are going to paint the top 12% of States in terms growing deaths due to Alzheimer.

```{r}
#We calculate the 88th percentile (top 12% threshold)
top_10_percent_threshold <- quantile(df_rank1$PercentChange, probs = 0.88, na.rm = TRUE)

#We create a new variable to indicate top 12%
df_rank1$Top10Percent <- ifelse(df_rank1$PercentChange > top_10_percent_threshold, "Top 12%", "Below Top 12%")

#For the merge to work, we ensure that state names in both datasets are in lowercase for successful merging
df_rank1$State <- tolower(df_rank1$State)
states_map <- map_data("state")
states_map$region <- tolower(states_map$region)

#Merging the datasets
df_map <- merge(states_map, df_rank1, by.x = "region", by.y = "State", all.x = TRUE)

#We plot the map
ggplot(data = df_map, aes(x = long, y = lat, group = group, fill = Top10Percent)) +
    geom_polygon(color = "black") +
    scale_fill_manual(values = c("Top 12%" = "red", "Below Top 12%" = "grey"), 
                      labels = c("Below Top 12%", "Top 12%")) +
    labs(fill = "Category") +
    theme_bw() +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.text.x = element_blank(), axis.text.y = element_blank(),
          axis.title.x = element_blank(), axis.title.y = element_blank()) +
    coord_fixed(1.4) +
    labs(title = "Top 6 States with highest Death Rates due to Alzheimer's") + theme(legend.position="none")

```
We can clearly see a cluster in the south-east of the U.S. This cluster concentrates the 12% that saw the biggest increase in deaths due to Alzhmeier's (age-adjusted).

According to this study: https://www.nia.nih.gov/news/data-shows-racial-disparities-alzheimers-disease-diagnosis-between-black-and-white-research, black people are almost twice more likely to develop dementia due to a higher exposure to risk factors. For this reason, we will investigate black race distribution by state.

First, let's take a look if there is indeed a difference between the Age-Adjusted Death Rate of Black vs White people:

```{r message=FALSE}
#Loading cases of Alzheimer distinguished by race across time: 
cdc_dataset_race = read_csv("NCHS_Leading_Causes_of_Death_United_States_2020_Race.csv")
cdc_dataset_race <- cdc_dataset_race |> mutate_all(~ifelse(is.na(.), 0, .))
cdc_usa_race = cdc_dataset_race |> filter(State == "United States") |> select(Year, Race, Age_Adj_Death_Rate)


#Pivot wider:
cdc_usa_race <- cdc_usa_race |> pivot_wider(names_from = Race, values_from = Age_Adj_Death_Rate)
cdc_usa_race <- cdc_usa_race |> mutate(across(-Year, ~ ./first(.) - 1))

#pivot_longer this data:
cdc_usa_race <- cdc_usa_race |> pivot_longer(cols = -Year, names_to = "Alzheimer", values_to = "Cumulative Change")


#Creating the time series plot
ggplot(cdc_usa_race, aes(x = Year, y = `Cumulative Change`, color = Alzheimer)) +
  geom_line(size = 1.3) +
  labs(title = "Cumulative Percentage Change ('99-'20) - Alzheimer - Age Adjusted Death Rate", x = "Year",
       y = "Cumulative Percentage Change", color = "Race") +
  theme_minimal() +
  theme(legend.position = "bottom") +
  scale_y_continuous(labels = scales::percent_format(), breaks = scales::pretty_breaks(n = 8))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10))
```
In fact, we can clearly see a difference between white and black people: the later having increased its death rate by 160% vs 95% during the last 20 years.



Let's see then the distribution of black people by state. We will take the averages across the time period:

```{r message=FALSE}
cdc_usa_race_pop = read_csv("NCHS_United_States_2020_Race_Distribution.csv")
cdc_usa_race_pop = cdc_usa_race_pop |> group_by(Race, State) |> summarize(Population = mean(Population))
cdc_usa_race_pop <- cdc_usa_race_pop |> pivot_wider(names_from = Race, values_from = Population)
cdc_usa_race_pop$Total = cdc_usa_race_pop$Black + cdc_usa_race_pop$White
cdc_usa_race_pop$Black = cdc_usa_race_pop$Black/cdc_usa_race_pop$Total
cdc_usa_race_pop = cdc_usa_race_pop |> select(State, Black)


#We calculate the 88th percentile (top 12% threshold)
cdc_usa_race_pop_threshold <- quantile(cdc_usa_race_pop$Black, probs = 0.80, na.rm = TRUE)

#We create a new variable
cdc_usa_race_pop$TopPercent <- ifelse(cdc_usa_race_pop$Black > cdc_usa_race_pop_threshold, "Top 25%", "Below Top 25%")

#For the merge to work, we ensure that state names in both datasets are in lowercase for successful merging
cdc_usa_race_pop$State <- tolower(cdc_usa_race_pop$State)
states_map <- map_data("state")
states_map$region <- tolower(states_map$region)

#Merging the datasets
df_map <- merge(states_map, cdc_usa_race_pop, by.x = "region", by.y = "State", all.x = TRUE)

#We plot the map
ggplot(data = df_map, aes(x = long, y = lat, group = group, fill = TopPercent)) +
    geom_polygon(color = "black") +
    scale_fill_manual(values = c("Top 25%" = "blue", "Below Top 25%" = "grey"), 
                      labels = c("Below Top 25%", "Top 25%")) +
    labs(fill = "Category") +
    theme_bw() +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.text.x = element_blank(), axis.text.y = element_blank(),
          axis.title.x = element_blank(), axis.title.y = element_blank()) +
    coord_fixed(1.4) +
    labs(title = "Top 10 States with highest proportion of Black People") + theme(legend.position="none")

# df_map %>% filter(TopPercent =="Top 25%") %>% distinct(region)

```
Although not perfect, we see a strong correlation that supports the study: southern states have the most share of black people, and it coincides with the states that have had higher increases of deaths due to Alzheimer's disease.



```{r message=FALSE}
df_life_expectancy <- read_csv("NCHS_-_Death_rates_and_life_expectancy_at_birth_20231111.csv")
#df_life_expectancy

df_life_expectancy_1939_to_1960 = df_life_expectancy %>% filter(Race == "All Races") %>% filter(Sex == "Both Sexes") %>% filter(Year >= 1939) %>% filter(Year <= 1960)  %>% select(-Race,-Sex,-`Age-adjusted Death Rate`)
#df_life_expectancy_1939_to_1960

alzheimer_crude = cdc_usa %>% filter(Cause == "Alzheimer's disease") %>% select(Year, Cause,Crude_Rate)
#alzheimer_crude

expectancy_alzheimer_regression_2 = cbind(alzheimer_crude,df_life_expectancy_1939_to_1960)

#expectancy_alzheimer_regression_2 # this is the table

ggplot(expectancy_alzheimer_regression_2 %>% select(`Crude_Rate`,`Average Life Expectancy (Years)`), aes(x = `Average Life Expectancy (Years)`, y = `Crude_Rate`)) +
  geom_point() + 
  geom_smooth(method = "lm") + 
  labs(x = "Average Life Expectancy", y = "Crude Rate", title = "Scatterplot Regression for Alzheimer's Crude Rate vs Life Expectancy (1999 - 2020)") + 
  labs(caption = "Correlation coefficient R = 0.88 ") +
  theme(plot.caption = element_text(hjust=.1))



```



```{r}
y = expectancy_alzheimer_regression_2$`Crude_Rate`
x = expectancy_alzheimer_regression_2$`Average Life Expectancy (Years)`

regression_model_cumul_growth <- lm(y ~ x)
cor.test(y,x)

```
According to CDC, the Alzheimer’s onset is around 60 years old. It’s interesting to note that there has been a general increase in life expectancy for people born between 1939 and 1960. In 1999, they would have reached 60 years old, which is around the age of first onset. The Life expectancy rose from 63.7 to 69.7 years old. Naturally, we see a very high positive correlation (0.88) between the increase of deaths due to Alzheimer’s disease and the rise in life expectancy.



### Analyzing Unintentional Injuries


The increase is clearly due to opioids:
https://www.cdc.gov/opioids/basics/epidemic.html

I was trying to get a dataset like: opioid sales.. but ofc, this is illegal market, and hard to record any data... it seems that deaths are the only dataset to track the consumption? Not sure....

```{r}
library(readr)
df_opiod <- read_csv("NCHS_Opiod_Dispense.csv")

df_opiod_state = df_opiod %>% filter(State != 'United States')
df_opiod_state = df_opiod_state %>% select(-StateAbb)
df_opiod_state_arranged =  df_opiod_state %>% arrange(desc(OpiodDispenseRatePer100))
df_opiod_state_arranged %>% filter(State == 'West Virginia')



df_opiod_state_arranged %>% filter(Year <= 2020) %>% group_by(State) %>% summarize(Avg = mean(OpiodDispenseRatePer100)) %>% arrange(desc(Avg)) %>% filter(Avg > 95)


z = df_opiod_state_arranged %>% filter(Year <= 2020) %>% group_by(State) %>% summarize(Avg = mean(OpiodDispenseRatePer100)) %>% arrange(desc(Avg)) %>% filter(Avg > 95)
z_reverse = z[order(z$Avg), ]
z_reverse

# ggplot(df_opiod_state_arranged %>% filter(Year <= 2020) %>% group_by(State) %>% summarize(Avg = mean(OpiodDispenseRatePer100)) %>% arrange(desc(Avg)) %>% filter(Avg > 95), aes(x = State, y = Avg)) +
#   geom_bar(stat = "identity", fill = '#8B4513')
  

my_cols <- c("blue", "darkgreen", "orange")
dotchart(z_reverse$Avg, labels = z_reverse$State,gcolor = "green",
         cex = 0.9, xlab = "Opioid Dispense Rate Per 100", main = "Top 8 Highest States with Average Opioid Dispense Rate for 2006-2020")



```

We see that West Virginia has the highest average dispensing rate 

```{r}
df_opiod_state_arranged_top5_states = df_opiod_state_arranged %>% filter(State == "West Virginia" | State == "Alabama" | State == "Tennessee" | State == "Kentucky" | State == "Arkansas" | State == "Mississippi" | State == "Oklahoma" | State == "Louisiana")

df_opiod_state_arranged_top5_states
  
ggplot(df_opiod_state_arranged_top5_states, aes(x = as.numeric(Year), y = OpiodDispenseRatePer100, color = State)) +
  geom_line(size = 1) +
  geom_point() +
  theme_minimal() +
  theme(legend.position = "bottom") 


```


```{r}
top5_states_adj_rate_unint = cdc_dataset %>% filter(State != "United States") %>% filter(Cause == "Unintentional injuries") %>% filter(Year > 2005)
top5_states_adj_rate_unint = top5_states_adj_rate_unint %>% group_by(State) %>% summarize(Avg = mean(Age_Adj_Rate)) %>% arrange(desc(Avg)) %>% filter(Avg > 57)# %>% filter(Avg > 57.4)
top5_states_adj_rate_unint

w = top5_states_adj_rate_unint
w

w_reverse = w[order(w$Avg), ]
w_reverse



dotchart(w_reverse$Avg, labels = w_reverse$State,gcolor = "green",
         cex = 0.9, xlab = "Age Adjusted Death Rate", main = "Top 8 Highest States w/ Avg Age-Adj Death Rate for Unintentional '06-'20")

```


```{r}
selected_top5 = cdc_dataset %>% filter(Cause == "Unintentional injuries") %>% 
  filter(State == "West Virginia" | State == "New Mexico" | State == "Kentucky" | State == "Mississippi" | State == "Alaska" | State == "Wyoming" | State == "Oklahoma" | State == "Tennessee")  %>% filter(Year > 2005)


  
selected_top5


ggplot(selected_top5, aes(x = as.numeric(Year), y = Age_Adj_Rate, color = State)) +
  geom_line(size = 1) +
  geom_point() +
  theme_minimal() +
  theme(legend.position = "bottom") 

```

```{r}
opiod_top8 = df_opiod_state_arranged_top5_states %>% distinct(State)
opiod_top8$State

death_rate_top8 = selected_top5 %>% distinct(State)
death_rate_top8$State

intersect(opiod_top8$State,death_rate_top8$State)
```

We see that chooseing 8 states that have had the highest average death rate from 2006 to 2020, and choosing 8 states that have had the highest average opiod dispensing, 5 states intersect. 



### Analyzing Suicide

Didnt manage to arrive here today.


```{r}
top10_avg_suicide_states = cdc_dataset %>% filter(State != "United States") %>% filter(Cause == "Suicide") %>% group_by(State) %>% summarize(Avg = mean(Age_Adj_Rate)) %>% arrange(desc(Avg)) %>% filter(Avg > 16.9)
top10_avg_suicide_states
```


```{r}
as.vector(top10_avg_suicide_states %>% distinct(State))
```

```{r}
lowest_population_density_states$
```


```{r}
united_states_by_area <- read_csv("united-states-by-area.csv")
# View(united_states_by_area)

united_states_by_area_density = united_states_by_area %>% select(state,densityMi) %>% arrange(densityMi)
lowest_population_density_states = united_states_by_area_density[1:10,]
lowest_population_density_states
```



##############
```{r}
united_states_by_area_density

colnames(united_states_by_area_density) <- c('State','densityMi')
united_states_by_area_density
```



```{r}
avg_suicide_rate = cdc_dataset %>% filter(State != "United States") %>% filter(Cause == "Suicide") %>% group_by(State) %>% summarize(Avg = mean(Age_Adj_Rate)) %>% arrange(desc(Avg))
avg_suicide_rate
```
```{r}
merged_df <- merge(united_states_by_area_density, avg_suicide_rate, by = "State")
merged_df
```
```{r}
boxplot(united_states_by_area_density$densityMi)
```



```{r}
ggplot(merged_df, aes(x = log(densityMi), y = Avg)) + geom_point() + geom_smooth(method = "lm") + 
  theme(plot.caption = element_text(hjust=.1))
```
```{r}
y = merged_df$Avg
x = log(merged_df$densityMi)
regression_model_cumul_growth <- lm(y ~ x)
cor.test(y,x)
summary(regression_model_cumul_growth)
```

```{r}
summary_gdp <- read_csv("SASUMMARY__ALL_AREAS_1998_2022.csv")
View(summary_gdp)

summary_gdp_only = summary_gdp %>% filter(Description == "Gross domestic product (GDP)") %>% select(GeoName,`2017`,`2018`,`2019`) %>% filter(GeoName != 'United States')
summary_gdp_only = summary_gdp_only %>% mutate(AvgGDP = (as.numeric(`2017`)+as.numeric(`2018`)+as.numeric(`2019`)) / 3)
summary_gdp_only

```
```{r}
colnames(summary_gdp_only) <- c('State','2017','2018','2019','AvgGDP')
summary_gdp_only
```

```{r}
merged_df2 <- merge(merged_df, summary_gdp_only, by = "State")
merged_df2
```

```{r}
boxplot(merged_df2$AvgGDP)

merged_df2 %>% arrange(desc(AvgGDP))
```

```{r}
merged_df2
```

```{r}
y = merged_df2$Avg

x = log(merged_df2$densityMi)
z = log(merged_df2$AvgGDP)

regression_model_cumul_growth_densityMil_AvgGDP <- lm(y ~ x + z)
summary(regression_model_cumul_growth_densityMil_AvgGDP)
```
```{r}

y = merged_df2$Avg
x = log(merged_df2$AvgGDP)
# x = merged_df2$AvgGDP

summary(lm(y ~ x))
```
```{r}
ggplot(merged_df2, aes(x = log(AvgGDP), y = Avg)) + geom_point() + geom_smooth(method = "lm") + 
  theme(plot.caption = element_text(hjust=.1))
```

